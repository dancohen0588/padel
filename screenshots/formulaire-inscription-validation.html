<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription au Tournoi - Validation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom gradient background */
        .gradient-bg {
            background: linear-gradient(135deg, #1E1E2E 0%, #2A2A3E 100%);
        }

        /* Hide number input arrows */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen px-5 py-10 text-white">
    <main class="mx-auto w-full max-w-[600px]">
        <!-- Header -->
        <div class="mb-10 text-center">
            <h1 class="bg-gradient-to-r from-orange-500 to-orange-400 bg-clip-text text-3xl font-bold text-transparent">
                Inscription au Tournoi
            </h1>
            <p class="mt-2 text-sm text-white/60">
                Superligue 15 Mars - Inscris-toi en quelques secondes.
            </p>
        </div>

        <!-- Main Form Container -->
        <div class="rounded-2xl border border-white/10 bg-white/5 p-8 shadow-[0_8px_32px_rgba(0,0,0,0.3)]">

            <!-- Mode Toggle -->
            <div class="mb-8 rounded-xl border border-white/10 bg-white/5 p-5">
                <label class="block text-sm font-semibold text-white/90">
                    Avez-vous d√©j√† particip√© √† un tournoi ?
                </label>
                <div class="mt-4 flex items-center gap-4">
                    <span id="newLabel" class="text-xs font-semibold text-orange-400 transition">
                        Non, premi√®re fois
                    </span>
                    <button
                        type="button"
                        id="modeToggle"
                        onclick="toggleMode()"
                        class="relative h-8 w-16 rounded-full border-2 border-white/20 bg-white/10 transition"
                        aria-label="Basculer participant existant"
                    >
                        <span id="toggleHandle" class="absolute left-1 top-1/2 h-6 w-6 -translate-y-1/2 rounded-full bg-white shadow transition"></span>
                    </button>
                    <span id="existingLabel" class="text-xs font-semibold text-white/60 transition">
                        Oui, j'ai d√©j√† jou√©
                    </span>
                </div>
                <div id="existingModeInfo" class="mt-4 hidden rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-4 py-3 text-xs text-emerald-300">
                    ‚ÑπÔ∏è Utilisez votre num√©ro de t√©l√©phone de votre premi√®re inscription pour retrouver votre compte et compiler vos statistiques.
                </div>
            </div>

            <!-- Form -->
            <form id="registrationForm" class="space-y-5">

                <!-- Phone Number (Required) -->
                <div>
                    <label for="phone" class="mb-2 block text-sm font-medium text-white/80">
                        Num√©ro de t√©l√©phone <span class="text-orange-400">*</span>
                    </label>
                    <input
                        id="phone"
                        name="phone"
                        type="tel"
                        placeholder="06 12 34 56 78 ou +33 6 12 34 56 78"
                        required
                        oninput="validatePhone()"
                        class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white placeholder:text-white/40 transition focus:border-orange-500/60 focus:outline-none"
                    />
                    <div id="phoneMessage" class="mt-2 hidden rounded-lg border px-4 py-3 text-sm"></div>
                    <p class="mt-2 text-xs text-white/50">
                        Formats accept√©s : 06.12.34.56.78, 06 12 34 56 78, 0612345678, +33 6 12 34 56 78
                    </p>
                </div>

                <!-- Verified Player Card (Existing Mode) -->
                <div id="verifiedPlayerCard" class="hidden rounded-xl border border-emerald-500/30 bg-emerald-500/10 p-4">
                    <div class="flex items-center gap-4">
                        <div class="flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-br from-orange-500 to-orange-400 text-xl font-semibold text-white">
                            JD
                        </div>
                        <div>
                            <p class="text-lg font-semibold text-white">John Doe</p>
                            <p class="text-sm text-white/60">06 12 34 56 78</p>
                        </div>
                    </div>
                    <div class="mt-4 border-t border-white/10 pt-3 text-sm text-white/70">
                        <div class="flex items-center justify-between py-1">
                            <span>Niveau</span>
                            <span class="font-semibold text-white">5 - Confirm√©</span>
                        </div>
                        <div class="flex items-center justify-between py-1">
                            <span>Tournois pr√©c√©dents</span>
                            <span class="font-semibold text-white">3 participations</span>
                        </div>
                    </div>
                </div>

                <!-- New Player Fields -->
                <div id="newPlayerFields" class="space-y-5">
                    <!-- Name Fields -->
                    <div class="grid gap-4 md:grid-cols-2">
                        <div>
                            <label for="firstName" class="mb-2 block text-sm font-medium text-white/80">
                                Pr√©nom <span class="text-orange-400">*</span>
                            </label>
                            <input
                                id="firstName"
                                name="firstName"
                                type="text"
                                placeholder="John"
                                required
                                class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-orange-500/60 focus:outline-none"
                            />
                        </div>
                        <div>
                            <label for="lastName" class="mb-2 block text-sm font-medium text-white/80">
                                Nom <span class="text-orange-400">*</span>
                            </label>
                            <input
                                id="lastName"
                                name="lastName"
                                type="text"
                                placeholder="Doe"
                                required
                                class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-orange-500/60 focus:outline-none"
                            />
                        </div>
                    </div>

                    <!-- Email (Optional) -->
                    <div>
                        <label for="email" class="mb-2 block text-sm font-medium text-white/80">
                            Email <span class="text-xs text-white/50">(optionnel)</span>
                        </label>
                        <input
                            id="email"
                            name="email"
                            type="email"
                            placeholder="votre@email.com"
                            class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-orange-500/60 focus:outline-none"
                        />
                        <p class="mt-2 text-xs text-white/50">
                            L'email est facultatif mais recommand√© pour recevoir les notifications.
                        </p>
                    </div>

                    <!-- Questionnaire Section -->
                    <div class="rounded-xl border border-orange-500/20 bg-orange-500/5 p-5 space-y-5">
                        <h3 class="text-sm font-semibold text-orange-400 mb-4">
                            üìã Questionnaire
                        </h3>

                        <!-- Question 1: Level 1-7 -->
                        <div>
                            <label for="level" class="mb-2 block text-sm font-medium text-white/80">
                                Quel est votre niveau ? <span class="text-orange-400">*</span>
                            </label>
                            <select
                                id="level"
                                name="level"
                                required
                                class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white focus:border-orange-500/60 focus:outline-none"
                            >
                                <option value="" disabled selected>S√©lectionnez votre niveau</option>
                                <option value="1">1 - D√©butant</option>
                                <option value="2">2 - D√©butant confirm√©</option>
                                <option value="3">3 - Interm√©diaire</option>
                                <option value="4">4 - Interm√©diaire confirm√©</option>
                                <option value="5">5 - Confirm√©</option>
                                <option value="6">6 - Avanc√©</option>
                                <option value="7">7 - Expert</option>
                            </select>
                            <p class="mt-2 text-xs text-white/50">
                                1 = D√©butant | 7 = Expert
                            </p>
                        </div>

                        <!-- Question 2: Classement Padel -->
                        <div>
                            <label class="mb-2 block text-sm font-medium text-white/80">
                                √ätes-vous class√© au padel ? <span class="text-orange-400">*</span>
                            </label>
                            <div class="flex gap-4 mb-3">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="radio"
                                        name="isRanked"
                                        value="non"
                                        checked
                                        onchange="toggleRankingField()"
                                        class="h-4 w-4 accent-orange-500"
                                    />
                                    <span class="text-sm text-white">Non</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input
                                        type="radio"
                                        name="isRanked"
                                        value="oui"
                                        onchange="toggleRankingField()"
                                        class="h-4 w-4 accent-orange-500"
                                    />
                                    <span class="text-sm text-white">Oui</span>
                                </label>
                            </div>

                            <!-- Conditional Ranking Field -->
                            <div id="rankingField" class="hidden mt-3">
                                <label for="ranking" class="mb-2 block text-sm font-medium text-white/80">
                                    Votre classement <span class="text-orange-400">*</span>
                                </label>
                                <input
                                    id="ranking"
                                    name="ranking"
                                    type="text"
                                    placeholder="Ex: P500, P1000, 15/1, 15/2..."
                                    class="w-full rounded-lg border border-white/20 bg-white/5 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-orange-500/60 focus:outline-none"
                                />
                            </div>
                        </div>

                        <!-- Question 3: Preference -->
                        <div>
                            <label class="mb-2 block text-sm font-medium text-white/80">
                                Avez-vous une pr√©f√©rence ? <span class="text-orange-400">*</span>
                            </label>
                            <div class="flex flex-col gap-3">
                                <label class="flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 cursor-pointer transition hover:bg-white/10">
                                    <input
                                        type="radio"
                                        name="preference"
                                        value="droite"
                                        required
                                        class="h-4 w-4 accent-orange-500"
                                    />
                                    <span class="text-sm text-white">Jouer √† droite</span>
                                </label>
                                <label class="flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 cursor-pointer transition hover:bg-white/10">
                                    <input
                                        type="radio"
                                        name="preference"
                                        value="gauche"
                                        required
                                        class="h-4 w-4 accent-orange-500"
                                    />
                                    <span class="text-sm text-white">Jouer √† gauche</span>
                                </label>
                                <label class="flex items-center gap-3 rounded-lg border border-white/10 bg-white/5 px-4 py-3 cursor-pointer transition hover:bg-white/10">
                                    <input
                                        type="radio"
                                        name="preference"
                                        value="aucune"
                                        checked
                                        required
                                        class="h-4 w-4 accent-orange-500"
                                    />
                                    <span class="text-sm text-white">Pas de pr√©f√©rence</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Messages -->
                <div id="formMessage" class="hidden rounded-lg border px-4 py-3 text-sm"></div>

                <!-- Action Buttons -->
                <div id="newPlayerButton" class="flex gap-3">
                    <button
                        type="submit"
                        class="flex-1 rounded-lg bg-gradient-to-r from-orange-500 to-orange-400 px-6 py-3 text-base font-semibold text-white transition hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(255,107,53,0.3)]"
                    >
                        S'inscrire au tournoi
                    </button>
                </div>

                <div id="existingPlayerButtons" class="hidden">
                    <!-- Verify Button -->
                    <div id="verifyButton" class="flex gap-3">
                        <button
                            type="button"
                            onclick="verifyPhone()"
                            class="flex-1 rounded-lg bg-gradient-to-r from-orange-500 to-orange-400 px-6 py-3 text-base font-semibold text-white transition hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(255,107,53,0.3)]"
                        >
                            V√©rifier mon compte
                        </button>
                    </div>

                    <!-- Confirm/Reset Buttons (shown after verification) -->
                    <div id="confirmButtons" class="hidden flex-col gap-3 sm:flex-row">
                        <button
                            type="submit"
                            class="flex-1 rounded-lg bg-gradient-to-r from-orange-500 to-orange-400 px-6 py-3 text-base font-semibold text-white transition hover:-translate-y-0.5 hover:shadow-[0_8px_16px_rgba(255,107,53,0.3)]"
                        >
                            Confirmer l'inscription
                        </button>
                        <button
                            type="button"
                            onclick="resetExistingFlow()"
                            class="flex-1 rounded-lg border border-white/20 bg-white/10 px-6 py-3 text-base font-semibold text-white transition hover:bg-white/15"
                        >
                            Ce n'est pas moi
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Success Message (hidden by default) -->
        <div id="successMessage" class="hidden mt-8 rounded-2xl border border-emerald-500/30 bg-emerald-500/10 p-6 text-center">
            <div class="space-y-3">
                <div class="text-sm font-semibold text-emerald-300">
                    ‚úÖ Inscription re√ßue
                </div>
                <p class="text-lg font-semibold text-white">
                    Inscription valid√©e par l'√©quipe !
                </p>
                <p class="text-sm text-white/70">
                    Vous recevrez une confirmation par SMS et email (si fourni) d√®s validation de votre inscription.
                </p>
                <div class="pt-2">
                    <a
                        href="/"
                        class="inline-flex items-center justify-center rounded-lg border border-white/20 bg-white/10 px-5 py-2 text-sm font-semibold text-white transition hover:bg-white/15"
                    >
                        Retour √† l'accueil
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentMode = 'new'; // 'new' or 'existing'
        let verifiedPlayer = null;

        // Toggle between new and existing player mode
        function toggleMode() {
            currentMode = currentMode === 'new' ? 'existing' : 'new';

            const toggle = document.getElementById('modeToggle');
            const handle = document.getElementById('toggleHandle');
            const newLabel = document.getElementById('newLabel');
            const existingLabel = document.getElementById('existingLabel');
            const existingModeInfo = document.getElementById('existingModeInfo');
            const newPlayerFields = document.getElementById('newPlayerFields');
            const newPlayerButton = document.getElementById('newPlayerButton');
            const existingPlayerButtons = document.getElementById('existingPlayerButtons');
            const phoneInput = document.getElementById('phone');

            if (currentMode === 'existing') {
                // Switch to existing mode
                toggle.classList.remove('border-white/20', 'bg-white/10');
                toggle.classList.add('border-orange-500', 'bg-gradient-to-r', 'from-orange-500', 'to-orange-400');
                handle.classList.remove('left-1');
                handle.classList.add('right-1');
                newLabel.classList.remove('text-orange-400');
                newLabel.classList.add('text-white/60');
                existingLabel.classList.remove('text-white/60');
                existingLabel.classList.add('text-orange-400');
                existingModeInfo.classList.remove('hidden');
                newPlayerFields.classList.add('hidden');
                newPlayerButton.classList.add('hidden');
                existingPlayerButtons.classList.remove('hidden');
                phoneInput.classList.add('border-orange-500/60', 'bg-orange-50/10', 'text-lg');
            } else {
                // Switch to new mode
                toggle.classList.add('border-white/20', 'bg-white/10');
                toggle.classList.remove('border-orange-500', 'bg-gradient-to-r', 'from-orange-500', 'to-orange-400');
                handle.classList.add('left-1');
                handle.classList.remove('right-1');
                newLabel.classList.add('text-orange-400');
                newLabel.classList.remove('text-white/60');
                existingLabel.classList.add('text-white/60');
                existingLabel.classList.remove('text-orange-400');
                existingModeInfo.classList.add('hidden');
                newPlayerFields.classList.remove('hidden');
                newPlayerButton.classList.remove('hidden');
                existingPlayerButtons.classList.add('hidden');
                phoneInput.classList.remove('border-orange-500/60', 'bg-orange-50/10', 'text-lg');
            }

            // Reset verification state
            resetExistingFlow();
        }

        // Normalize phone number to E.164 format
        function normalizePhone(phone) {
            // Remove all non-digit characters
            let digits = phone.replace(/\D/g, '');

            // Handle different formats
            if (digits.startsWith('33')) {
                // Already has country code
                return '+' + digits;
            } else if (digits.startsWith('0') && digits.length === 10) {
                // French number without country code
                return '+33' + digits.substring(1);
            } else if (digits.length === 9) {
                // Missing leading 0
                return '+33' + digits;
            }

            return null; // Invalid format
        }

        // Validate phone number format
        function validatePhone() {
            const phoneInput = document.getElementById('phone');
            const phoneMessage = document.getElementById('phoneMessage');
            const phone = phoneInput.value.trim();

            if (!phone) {
                phoneMessage.classList.add('hidden');
                phoneInput.classList.remove('border-emerald-500/60', 'border-red-500/60');
                phoneInput.classList.add('border-white/20');
                return false;
            }

            const normalized = normalizePhone(phone);

            if (normalized) {
                // Valid format
                phoneMessage.classList.remove('hidden', 'border-red-500/30', 'bg-red-500/10', 'text-red-300');
                phoneMessage.classList.add('border-emerald-500/30', 'bg-emerald-500/10', 'text-emerald-300');
                phoneMessage.textContent = `‚úì Format valide : ${normalized}`;
                phoneInput.classList.remove('border-white/20', 'border-red-500/60');
                phoneInput.classList.add('border-emerald-500/60');
                return true;
            } else {
                // Invalid format
                phoneMessage.classList.remove('hidden', 'border-emerald-500/30', 'bg-emerald-500/10', 'text-emerald-300');
                phoneMessage.classList.add('border-red-500/30', 'bg-red-500/10', 'text-red-300');
                phoneMessage.textContent = '‚úó Format invalide. Utilisez un format comme : 06 12 34 56 78 ou +33 6 12 34 56 78';
                phoneInput.classList.remove('border-white/20', 'border-emerald-500/60');
                phoneInput.classList.add('border-red-500/60');
                return false;
            }
        }

        // Toggle ranking field visibility
        function toggleRankingField() {
            const isRanked = document.querySelector('input[name="isRanked"]:checked').value;
            const rankingField = document.getElementById('rankingField');
            const rankingInput = document.getElementById('ranking');

            if (isRanked === 'oui') {
                rankingField.classList.remove('hidden');
                rankingInput.required = true;
            } else {
                rankingField.classList.add('hidden');
                rankingInput.required = false;
                rankingInput.value = '';
            }
        }

        // Verify phone for existing player
        function verifyPhone() {
            const phoneInput = document.getElementById('phone');
            const phone = phoneInput.value.trim();
            const phoneMessage = document.getElementById('phoneMessage');

            if (!validatePhone()) {
                return;
            }

            // Simulate API call
            setTimeout(() => {
                // Simulate found player
                verifiedPlayer = {
                    firstName: 'John',
                    lastName: 'Doe',
                    phone: normalizePhone(phone),
                    level: 5,
                    tournamentsPlayed: 3
                };

                // Show verified player card
                const verifiedCard = document.getElementById('verifiedPlayerCard');
                verifiedCard.classList.remove('hidden');

                // Update phone message
                phoneMessage.classList.remove('hidden', 'border-red-500/30', 'bg-red-500/10', 'text-red-300');
                phoneMessage.classList.add('border-emerald-500/30', 'bg-emerald-500/10', 'text-emerald-300');
                phoneMessage.textContent = `‚úì Compte trouv√© : ${verifiedPlayer.firstName} ${verifiedPlayer.lastName}. Confirmez pour vous inscrire √† ce tournoi.`;

                // Make phone input readonly
                phoneInput.readOnly = true;

                // Switch buttons
                document.getElementById('verifyButton').classList.add('hidden');
                document.getElementById('confirmButtons').classList.remove('hidden');
                document.getElementById('confirmButtons').classList.add('flex');
            }, 500);
        }

        // Reset existing player flow
        function resetExistingFlow() {
            const phoneInput = document.getElementById('phone');
            const phoneMessage = document.getElementById('phoneMessage');
            const verifiedCard = document.getElementById('verifiedPlayerCard');

            verifiedPlayer = null;
            phoneInput.readOnly = false;
            phoneInput.value = '';
            phoneInput.classList.remove('border-emerald-500/60', 'border-red-500/60');
            phoneInput.classList.add('border-white/20');
            phoneMessage.classList.add('hidden');
            verifiedCard.classList.add('hidden');

            document.getElementById('verifyButton').classList.remove('hidden');
            document.getElementById('confirmButtons').classList.add('hidden');
        }

        // Handle form submission
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate phone
            if (!validatePhone()) {
                return;
            }

            // Get form data
            const formData = new FormData(this);
            const data = {
                mode: currentMode,
                phone: normalizePhone(formData.get('phone'))
            };

            if (currentMode === 'new') {
                data.firstName = formData.get('firstName');
                data.lastName = formData.get('lastName');
                data.email = formData.get('email') || null;
                data.level = formData.get('level');
                data.isRanked = formData.get('isRanked') === 'oui';
                data.ranking = data.isRanked ? formData.get('ranking') : null;
                data.preference = formData.get('preference');
            } else {
                data.playerId = verifiedPlayer?.id || 'existing-player-id';
            }

            console.log('Form submitted with data:', data);

            // Show success message
            document.querySelector('.rounded-2xl.border.border-white\\/10').classList.add('hidden');
            document.getElementById('successMessage').classList.remove('hidden');
        });
    </script>
</body>
</html>
